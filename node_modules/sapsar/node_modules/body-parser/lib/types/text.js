/*!
 * body-parser
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */
"use strict";var bytes=require("bytes"),contentType=require("content-type"),debug=require("debug")("body-parser:text"),read=require("../read"),typeis=require("type-is");function text(options){var opts=options||{},defaultCharset=opts.defaultCharset||"utf-8",inflate=!1!==opts.inflate,limit="number"!=typeof opts.limit?bytes.parse(opts.limit||"100kb"):opts.limit,type=opts.type||"text/plain",verify=opts.verify||!1;if(!1!==verify&&"function"!=typeof verify)throw new TypeError("option verify must be function");var shouldParse="function"!=typeof type?typeChecker(type):type;function parse(buf){return buf}return function(req,res,next){if(req._body)return debug("body already parsed"),void next();if(req.body=req.body||{},!typeis.hasBody(req))return debug("skip empty body"),void next();if(debug("content-type %j",req.headers["content-type"]),!shouldParse(req))return debug("skip parsing"),void next();var charset=getCharset(req)||defaultCharset;read(req,res,next,parse,debug,{encoding:charset,inflate:inflate,limit:limit,verify:verify})}}function getCharset(req){try{return(contentType.parse(req).parameters.charset||"").toLowerCase()}catch(e){return}}function typeChecker(type){return function(req){return Boolean(typeis(req,type))}}module.exports=text;